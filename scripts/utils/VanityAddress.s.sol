// SPDX-License-Identifier: GPL-3.0
pragma solidity ^0.8.19;

import { Utils } from "./Utils.s.sol";
import "stringutils/strings.sol";
import { stdJson } from "forge-std/StdJson.sol";
import { console } from "forge-std/console.sol";
import "../Constants.s.sol";

contract VanityAddress is Utils {
    using stdJson for string;

    function _findDeploymentAddress(
        bytes32 salt,
        bytes memory initCode
    ) internal pure returns (address deploymentAddress) {
        deploymentAddress = address(
            uint160( // downcast to match the address type.
                uint256( // convert to uint to truncate upper digits.
                    keccak256( // compute the CREATE2 hash using 4 inputs.
                        abi.encodePacked( // pack all inputs to the hash together.
                            hex"ff", // start with 0xff to distinguish from RLP.
                            IMMUTABLE_CREATE2_FACTORY_ADDRESS, // this contract will be the caller.
                            salt, // pass in the supplied salt value.
                            keccak256(abi.encodePacked(initCode)) // pass in the hash of initialization code.
                        )
                    )
                )
            )
        );
    }

    function run() external {
        // Make sure that the initCode has been obtained through a via-IR compilation, or through the exact same setup as the deployment setup

        // Transmuter code with production code for USD here
        bytes
            memory initCode = hex"6080604052610de5803803806100148161021e565b928339606090818382810103126100da578251916001600160401b0383116100da57818401601f8486010112156100da578284015161005a61005582610243565b61021e565b93602085838152019084870160208460051b838a010101116100da57602081880101915b60208460051b838a01010183106100df5787878761009e6020840161025a565b6040840151939091906001600160401b0385116100da576100cc946100c692820191016102ac565b9161049e565b60405160f19081610cb48239f35b600080fd5b82516001600160401b0381116100da578289010185601f1982898c010301126100da5761010a6101db565b906101176020820161025a565b8252604081015160038110156100da57602083015280870151906001600160401b0382116100da5701878a01603f820112156100da5760208101519061015f61005583610243565b91602083828152018a8d0160408360051b850101116100da5760408301905b60408360051b85010182106101a45750505050604082015281526020928301920161007e565b81516001600160e01b0319811681036100da5781526020918201910161017e565b634e487b7160e01b600052604160045260246000fd5b60405190606082016001600160401b038111838210176101fa57604052565b6101c5565b60408051919082016001600160401b038111838210176101fa57604052565b6040519190601f01601f191682016001600160401b038111838210176101fa57604052565b6001600160401b0381116101fa5760051b60200190565b51906001600160a01b03821682036100da57565b6001600160401b0381116101fa57601f01601f191660200190565b60005b83811061029c5750506000910152565b818101518382015260200161028c565b81601f820112156100da5780516102c56100558261026e565b92818452602082840101116100da576102e49160208085019101610289565b90565b634e487b7160e01b600052601160045260246000fd5b600019811461030c5760010190565b6102e7565b634e487b7160e01b600052603260045260246000fd5b805182101561033b5760209160051b010190565b610311565b6003111561034a57565b634e487b7160e01b600052602160045260246000fd5b51600381101561034a5790565b90815180825260208080930193019160005b82811061038d575050505090565b83516001600160e01b0319168552938101939281019260010161037f565b906020916103c481518092818552858086019101610289565b601f01601f1916010190565b93929091936060928382019380835281518095526080830160808660051b85010195602080940192600080915b83831061042f575050505050506102e494956104229183019060018060a01b03169052565b60408184039101526103ab565b909192939498607f1988820301865289519060018060a01b03825116815287820151600381101561048a5761047c60019385848c959486809601528160408094015193820152019061036d565b9b01960194930191906103fd565b634e487b7160e01b85526021600452602485fd5b929190835160005b8181106104f05750507f8faa70878671ccd212d20771b795c50af8fd3ff6cf27f4bde57e5d4de0aeb673816104ee94956104e685604051938493846103d0565b0390a16105eb565b565b6040806104fd8389610327565b51015161051b61050d848a610327565b51516001600160a01b031690565b918151156105a65750908291610540602061053961055d968c610327565b5101610360565b61054981610340565b80610562575061055891610751565b6102fd565b6104a6565b61056b81610340565b6001810361057d5750610558916108a9565b80610589600292610340565b14610596575b50506102fd565b61059f91610a81565b388061058f565b5163e767f91f60e01b81526001600160a01b0383166004820152602490fd5b0390fd5b6001600160a01b0390911681526040602082018190526102e4929101906103ab565b906001600160a01b0382161561066e5761060482610c99565b600080825160208401855af4913d15610666573d926106256100558561026e565b9384523d6000602086013e5b1561063b57505050565b82511561064a57825160208401fd5b6105c560405192839263192105d760e01b8452600484016105c9565b606092610631565b5050565b9060206102e492818152019061036d565b8151815460209093015161ffff60a01b60a09190911b166001600160b01b03199093166001600160a01b0390911617919091179055565b90600080516020610dc5833981519152805483101561033b57600052601c60206000208360031c019260021b1690565b600080516020610dc583398151915290815491680100000000000000008310156101fa57826107219160016104ee950190556106ba565b90919063ffffffff83549160031b9260e01c831b921b1916179055565b61ffff80911690811461030c5760010190565b906001600160a01b0382161561088c57600080516020610dc58339815191525461ffff1661077e83610c99565b8151916000915b838310610793575050505050565b6107ae6107a08484610327565b516001600160e01b03191690565b6107f76107eb6107de8363ffffffff60e01b16600052600080516020610da5833981519152602052604060002090565b546001600160a01b031690565b6001600160a01b031690565b610868576108629161085761085c926108526108116101ff565b6001600160a01b038b16815261ffff851660208201526001600160e01b031983166000908152600080516020610da583398151915260205260409020610683565b6106ea565b61073e565b926102fd565b91610785565b60405163ebbf5d0760e01b81526001600160e01b0319919091166004820152602490fd5b6040516302b8da0760e21b81529081906105c59060048301610672565b6001600160a01b038116919082156109e6576108c481610c99565b81519160005b8381106108d8575050505050565b6108e56107a08284610327565b6109156107eb6107de8363ffffffff60e01b16600052600080516020610da5833981519152602052604060002090565b3081146109c4578681146109a2571561097e57906105588461095a6109799463ffffffff60e01b16600052600080516020610da5833981519152602052604060002090565b80546001600160a01b0319166001600160a01b03909216919091179055565b6108ca565b604051637479f93960e01b81526001600160e01b0319919091166004820152602490fd5b604051631ac6ce8d60e11b81526001600160e01b031983166004820152602490fd5b604051632901806d60e11b81526001600160e01b031983166004820152602490fd5b60405163cd98a96f60e01b8152806105c58460048301610672565b9061ffff610a0d6101ff565b92546001600160a01b038116845260a01c166020830152565b801561030c576000190190565b600080516020610dc583398151915280548015610a6b576000190190610a58826106ba565b63ffffffff82549160031b1b1916905555565b634e487b7160e01b600052603160045260246000fd5b600080516020610dc58339815191525491906001600160a01b038116610c765750809291925190600090815b838110610abc57505050509050565b610ac96107a08284610327565b95610afc610af78863ffffffff60e01b16600052600080516020610da5833981519152602052604060002090565b610a01565b8051909190610b13906001600160a01b03166107eb565b15610c545781513090610b2e906001600160a01b03166107eb565b14610c3257610b9460209798610b9a9493610b498894610a26565b998a91018161ffff610b5d835161ffff1690565b1603610ba2575b5050610b6e610a33565b63ffffffff60e01b16600052600080516020610da5833981519152602052604060002090565b556102fd565b949394610aad565b610c0c610be5610bc4610bb7610c2b956106ba565b90549060031b1c60e01b90565b92610bdd84610721610bd8845161ffff1690565b6106ba565b5161ffff1690565b9163ffffffff60e01b16600052600080516020610da5833981519152602052604060002090565b805461ffff60a01b191660a09290921b61ffff60a01b16919091179055565b8838610b64565b604051630df5fd6160e31b81526001600160e01b031989166004820152602490fd5b604051637a08a22d60e01b81526001600160e01b031989166004820152602490fd5b60405163d091bc8160e01b81526001600160a01b03919091166004820152602490fd5b3b15610ca157565b60405163c1df45cf60e01b8152600490fdfe60007fffffffff000000000000000000000000000000000000000000000000000000008135168082527fc8fcad8db84d3cc18b4c41d551ea0ee66dd599cde068d998e57d5e09332c131c60205273ffffffffffffffffffffffffffffffffffffffff604083205416908115608e57508180913682608037608036915af43d809260803e15608a576080f35b6080fd5b7f5416eb980000000000000000000000000000000000000000000000000000000060805260845260246080fdfea2646970667358221220f7555e579d1647bd1a1a6ec8c28b11a5e145ccb1b2ed6f6b2426d5c9f004de4364736f6c63430008130033c8fcad8db84d3cc18b4c41d551ea0ee66dd599cde068d998e57d5e09332c131cc8fcad8db84d3cc18b4c41d551ea0ee66dd599cde068d998e57d5e09332c131b0000000000000000000000000000000000000000000000000000000000000060000000000000000000000000c214745bd85b187bfae495f41bf64f2ee82fabb40000000000000000000000000000000000000000000000000000000000000ce00000000000000000000000000000000000000000000000000000000000000009000000000000000000000000000000000000000000000000000000000000012000000000000000000000000000000000000000000000000000000000000001c00000000000000000000000000000000000000000000000000000000000000280000000000000000000000000000000000000000000000000000000000000038000000000000000000000000000000000000000000000000000000000000006c0000000000000000000000000000000000000000000000000000000000000076000000000000000000000000000000000000000000000000000000000000009200000000000000000000000000000000000000000000000000000000000000a200000000000000000000000000000000000000000000000000000000000000b6000000000000000000000000053b7d70013dec21a97f216e80eefcf45f25c29000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000011f931c1c00000000000000000000000000000000000000000000000000000000000000000000000000000000fa94cd9d711de75695693c877beca5473462cf120000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000025c60da1b00000000000000000000000000000000000000000000000000000000c39aa07d0000000000000000000000000000000000000000000000000000000000000000000000000000000065ddeedf8e68f26d787b678e28af13fde0249967000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000600000000000000000000000000000000000000000000000000000000000000004cdffacc60000000000000000000000000000000000000000000000000000000052ef6b2c00000000000000000000000000000000000000000000000000000000adfca15e000000000000000000000000000000000000000000000000000000007a0ed62700000000000000000000000000000000000000000000000000000000000000000000000000000000d1b575ed715e4630340bfdc4fb8a37df3383c84a000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000600000000000000000000000000000000000000000000000000000000000000016b4a0bdf300000000000000000000000000000000000000000000000000000000ee565a6300000000000000000000000000000000000000000000000000000000847da7be00000000000000000000000000000000000000000000000000000000eb7aac5f000000000000000000000000000000000000000000000000000000003335221000000000000000000000000000000000000000000000000000000000b718136100000000000000000000000000000000000000000000000000000000b85780bc00000000000000000000000000000000000000000000000000000000cd377c5300000000000000000000000000000000000000000000000000000000782513bd0000000000000000000000000000000000000000000000000000000094e35d9e000000000000000000000000000000000000000000000000000000004ea3e3430000000000000000000000000000000000000000000000000000000010d3d22e0000000000000000000000000000000000000000000000000000000038c269eb00000000000000000000000000000000000000000000000000000000adc9d1f7000000000000000000000000000000000000000000000000000000008db9653f000000000000000000000000000000000000000000000000000000000d1266270000000000000000000000000000000000000000000000000000000096d6487900000000000000000000000000000000000000000000000000000000fe7d0c540000000000000000000000000000000000000000000000000000000077dc342900000000000000000000000000000000000000000000000000000000f9839d8900000000000000000000000000000000000000000000000000000000a52aefd40000000000000000000000000000000000000000000000000000000099eeca4900000000000000000000000000000000000000000000000000000000000000000000000000000000770756e43b9ac742538850003791def3020211f300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000060000000000000000000000000000000000000000000000000000000000000000105b41934000000000000000000000000000000000000000000000000000000000000000000000000000000001f37f93c6aa7d987ae04786145d3066eab8eeb4300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000060000000000000000000000000000000000000000000000000000000000000000af0d2d5a800000000000000000000000000000000000000000000000000000000c1cdee7e0000000000000000000000000000000000000000000000000000000087c8ab7a000000000000000000000000000000000000000000000000000000005c3eebda000000000000000000000000000000000000000000000000000000001f0ec8ee000000000000000000000000000000000000000000000000000000000e32cb860000000000000000000000000000000000000000000000000000000081ee2deb00000000000000000000000000000000000000000000000000000000b13b0847000000000000000000000000000000000000000000000000000000001b0c7182000000000000000000000000000000000000000000000000000000007c0343a100000000000000000000000000000000000000000000000000000000000000000000000000000000dda8f002925a0dfb151c0eacb48d7136ce6a999f000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000600000000000000000000000000000000000000000000000000000000000000004629feb62000000000000000000000000000000000000000000000000000000004eec47b900000000000000000000000000000000000000000000000000000000a9e6a1a400000000000000000000000000000000000000000000000000000000b607d0990000000000000000000000000000000000000000000000000000000000000000000000000000000006c33a0c80c3970cbedde641c7a6419d703d93d70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000064583aea6000000000000000000000000000000000000000000000000000000009525f3ab000000000000000000000000000000000000000000000000000000003b6a1fe000000000000000000000000000000000000000000000000000000000d92c6cb200000000000000000000000000000000000000000000000000000000b92567fa00000000000000000000000000000000000000000000000000000000c10a6287000000000000000000000000000000000000000000000000000000000000000000000000000000001e45b65cdd3712fef0024d063d6574a609985e59000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000600000000000000000000000000000000000000000000000000000000000000004d703a0cd00000000000000000000000000000000000000000000000000000000815822c1000000000000000000000000000000000000000000000000000000002e7639bc00000000000000000000000000000000000000000000000000000000fd7daaf8000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000064c0c53b8b0000000000000000000000005bc6bef80da563ebf6df6d6913513fa9a7ec89be000000000000000000000000862068a632aa8aeddc5b498d0b968becce7a209e0000000000000000000000005d34839a3d4051f630d36e26698d53c58dd3907200000000000000000000000000000000000000000000000000000000";
        // Deploy diamond
        string memory json = vm.readFile(JSON_VANITY_PATH);
        uint256 initInt = json.readUint(string.concat("$.", "init"));
        uint256 i = initInt;
        address computedAddress;
        bool found = false;
        while (!found && i - initInt < 3000000) {
            computedAddress = _findDeploymentAddress(
                bytes32(abi.encodePacked(DEPLOYER, abi.encodePacked(uint96(i)))),
                initCode
            );
            if (uint24(uint160(bytes20(computedAddress)) >> 136) == uint24(0x222222)) {
                found = true;
                break;
            }
            i = i + 1;
        }

        console.log("found ", found);
        console.log("i ", i);
        console.logBytes32(bytes32(abi.encodePacked(DEPLOYER, abi.encodePacked(uint96(i)))));
        console.log("computedAddress ", computedAddress);
    }
}

/*
Init code for stEUR
        bytes
            memory initCode = hex"60406080815262000cdb80380380620000188162000364565b9283398101906060818303126200035f576200003481620003a0565b9160209262000045848401620003a0565b8584015190936001600160401b0391908282116200035f57019280601f850112156200035f57835193620000836200007d86620003b5565b62000364565b94808652878601928882840101116200035f578288620000a49301620003d1565b823b1562000305577f360894a13ba1a3210667c828492db98dca3e2076cc3735a920a3ca505d382bbc80546001600160a01b03199081166001600160a01b0386811691821790935590959194600093909290917fbc7cd75a20ee27fd9adebab32041f755214dbc6bffa90cc0225b39da2e5c2d3b8580a2805115801590620002fd575b620001f5575b50505050507fb53127684a568b3173ae13b9f8a6016e243e63b6e8ee1178d6a717850b5d6103937f7e644d79422f17c01e4894b5f4f588d331ebfa28653d42ae832dc59e38c9798f86865493815196818616885216958684820152a18315620001a3575016179055516108869081620004558239f35b60849086519062461bcd60e51b82526004820152602660248201527f455243313936373a206e65772061646d696e20697320746865207a65726f206160448201526564647265737360d01b6064820152fd5b8951946060860190811186821017620002e9578a52602785527f416464726573733a206c6f772d6c6576656c2064656c65676174652063616c6c89860152660819985a5b195960ca1b8a860152823b156200029657928092819262000280969551915af43d156200028c573d620002706200007d82620003b5565b9081528092893d92013e620003f6565b5038808080806200012d565b60609150620003f6565b895162461bcd60e51b8152600481018a9052602660248201527f416464726573733a2064656c65676174652063616c6c20746f206e6f6e2d636f6044820152651b9d1c9858dd60d21b6064820152608490fd5b634e487b7160e01b85526041600452602485fd5b508362000127565b865162461bcd60e51b815260048101879052602d60248201527f455243313936373a206e657720696d706c656d656e746174696f6e206973206e60448201526c1bdd08184818dbdb9d1c9858dd609a1b6064820152608490fd5b600080fd5b6040519190601f01601f191682016001600160401b038111838210176200038a57604052565b634e487b7160e01b600052604160045260246000fd5b51906001600160a01b03821682036200035f57565b6001600160401b0381116200038a57601f01601f191660200190565b60005b838110620003e55750506000910152565b8181015183820152602001620003d4565b9091901562000403575090565b815115620004145750805190602001fd5b6044604051809262461bcd60e51b825260206004830152620004468151809281602486015260208686019101620003d1565b601f01601f19168101030190fdfe60806040526004361015610019575b3661037c575b61037c565b6000803560e01c9081633659cfe61461006c575080634f1ef286146100675780635c60da1b146100625780638f2839701461005d5763f851a4400361000e57610326565b610212565b61019e565b6100ef565b346100d15760203660031901126100d1576100856100d4565b6001600160a01b037fb53127684a568b3173ae13b9f8a6016e243e63b6e8ee1178d6a717850b5d610354163314600014610014576100ce906100c56104af565b90838252610516565b80f35b80fd5b600435906001600160a01b03821682036100ea57565b600080fd5b60403660031901126100ea576101036100d4565b60243567ffffffffffffffff918282116100ea57366023830112156100ea5781600401359283116100ea5736602484840101116100ea576001600160a01b037fb53127684a568b3173ae13b9f8a6016e243e63b6e8ee1178d6a717850b5d61035416331460001461001457600060208480602461018a61018561019c996104fa565b6104d4565b96828852018387013784010152610624565b005b346100ea5760003660031901126100ea576001600160a01b03807fb53127684a568b3173ae13b9f8a6016e243e63b6e8ee1178d6a717850b5d610354163314600014610014577f360894a13ba1a3210667c828492db98dca3e2076cc3735a920a3ca505d382bbc5460405191168152602090f35b346100ea5760203660031901126100ea5761022b6100d4565b6001600160a01b03907fb53127684a568b3173ae13b9f8a6016e243e63b6e8ee1178d6a717850b5d610391808354163314600014610014577f7e644d79422f17c01e4894b5f4f588d331ebfa28653d42ae832dc59e38c9798f604084549281519481851686521693846020820152a181156102bc5773ffffffffffffffffffffffffffffffffffffffff1916179055005b608460405162461bcd60e51b815260206004820152602660248201527f455243313936373a206e65772061646d696e20697320746865207a65726f206160448201527f64647265737300000000000000000000000000000000000000000000000000006064820152fd5b346100ea5760003660031901126100ea576001600160a01b037fb53127684a568b3173ae13b9f8a6016e243e63b6e8ee1178d6a717850b5d61039080825416331460001461001457905460405191168152602090f35b6001600160a01b03807fb53127684a568b3173ae13b9f8a6016e243e63b6e8ee1178d6a717850b5d6103541633146103f0577f360894a13ba1a3210667c828492db98dca3e2076cc3735a920a3ca505d382bbc54166000808092368280378136915af43d82803e156103ec573d90f35b3d90fd5b60a460405162461bcd60e51b815260206004820152604260248201527f5472616e73706172656e745570677261646561626c6550726f78793a2061646d60448201527f696e2063616e6e6f742066616c6c6261636b20746f2070726f7879207461726760648201527f65740000000000000000000000000000000000000000000000000000000000006084820152fd5b7f4e487b7100000000000000000000000000000000000000000000000000000000600052604160045260246000fd5b604051906020820182811067ffffffffffffffff8211176104cf57604052565b610480565b6040519190601f01601f1916820167ffffffffffffffff8111838210176104cf57604052565b67ffffffffffffffff81116104cf57601f01601f191660200190565b803b156105ba576001600160a01b0381167f360894a13ba1a3210667c828492db98dca3e2076cc3735a920a3ca505d382bbc8173ffffffffffffffffffffffffffffffffffffffff198254161790557fbc7cd75a20ee27fd9adebab32041f755214dbc6bffa90cc0225b39da2e5c2d3b600080a28151158015906105b2575b61059d575050565b6105af916105a96106b2565b91610722565b50565b506000610595565b608460405162461bcd60e51b815260206004820152602d60248201527f455243313936373a206e657720696d706c656d656e746174696f6e206973206e60448201527f6f74206120636f6e7472616374000000000000000000000000000000000000006064820152fd5b803b156105ba576001600160a01b0381167f360894a13ba1a3210667c828492db98dca3e2076cc3735a920a3ca505d382bbc8173ffffffffffffffffffffffffffffffffffffffff198254161790557fbc7cd75a20ee27fd9adebab32041f755214dbc6bffa90cc0225b39da2e5c2d3b600080a28151158015906106aa5761059d575050565b506001610595565b604051906060820182811067ffffffffffffffff8211176104cf57604052602782527f206661696c6564000000000000000000000000000000000000000000000000006040837f416464726573733a206c6f772d6c6576656c2064656c65676174652063616c6c60208201520152565b9190823b1561076b576000816107609460208394519201905af43d15610763573d90610750610185836104fa565b9182523d6000602084013e6107d5565b90565b6060906107d5565b608460405162461bcd60e51b815260206004820152602660248201527f416464726573733a2064656c65676174652063616c6c20746f206e6f6e2d636f60448201527f6e747261637400000000000000000000000000000000000000000000000000006064820152fd5b909190156107e1575090565b8151156107f15750805190602001fd5b6040519062461bcd60e51b82528160208060048301528251908160248401526000935b828510610837575050604492506000838284010152601f80199101168101030190fd5b848101820151868601604401529381019385935061081456fea2646970667358221220cd51d87f687e65d41171d5f157313805c8c9f1c12984f1d6b0d726a20f3df98e64736f6c634300081300330000000000000000000000000000000000ffe8b47b3e2130213b802212439497000000000000000000000000fda462548ce04282f4b6d6619823a7c64fdc018500000000000000000000000000000000000000000000000000000000000000600000000000000000000000000000000000000000000000000000000000000000";
        */
